# Arduino UNO R4 WiFi 两轮平衡循线小车项目计划

## 一、项目概述
制作一个集成平衡控制、循线功能、障碍物检测和实时显示的智能小车。

## 二、所需硬件清单

### 核心控制
1. **Arduino UNO R4 WiFi** × 1
2. **MPU6050 六轴陀螺仪加速度计** × 1（用于平衡控制）

### 运动系统
3. **直流减速电机（带编码器）** × 2（推荐JGA25-370或类似，12V）
4. **电机驱动模块** × 1（推荐L298N或TB6612FNG）
5. **车轮** × 2（直径65-80mm）
6. **万向轮/支撑轮** × 1（辅助支撑）

### 循线系统
7. **红外循线传感器模块** × 3-5（TCRT5000模块，3个可实现基本循线，5个更精确）

### 障碍物检测系统
8. **LiDAR传感器** × 1（推荐TF-Luna、TF-Mini Plus或VL53L0X）
9. **舵机** × 1（SG90或MG90S，用于旋转LiDAR扫描）
10. **舵机支架** × 1

### 显示系统
11. **1.2寸彩色屏幕** × 1（推荐ST7789或ST7735驱动的SPI屏幕，分辨率240×240）

### 电源系统
12. **7.4V或11.1V锂电池** × 1（2S或3S，容量2000mAh以上）
13. **5V降压模块** × 1（用于Arduino和传感器供电，推荐LM2596）
14. **电源开关** × 1
15. **电池充电器** × 1

### 结构件与配件
16. **小车底盘** × 1（亚克力或3D打印）
17. **杜邦线** 若干（公对公、公对母、母对母）
18. **面包板或万能板** × 1（用于接线）
19. **螺丝螺母** 若干
20. **扎带/魔术贴** 若干

---

## 三、接线方案

### 电源分配
- 7.4V/11.1V电池 → L298N电机驱动（VCC）
- 7.4V/11.1V电池 → 降压模块 → 5V输出
- 5V → Arduino VIN、MPU6050、红外传感器、舵机、屏幕

### 引脚分配（Arduino UNO R4 WiFi）

| 模块               | 引脚连接                                                  |
| ------------------ | --------------------------------------------------------- |
| **MPU6050**        | SDA→A4, SCL→A5, VCC→5V, GND→GND                           |
| **L298N电机驱动**  | IN1→D4, IN2→D5, IN3→D6, IN4→D7, ENA→D9(PWM), ENB→D10(PWM) |
| **左电机编码器**   | D2（中断0）                                               |
| **右电机编码器**   | D3（中断1）                                               |
| **红外传感器**     | 左→A0, 中→A1, 右→A2（如用5个则增加A3、A6）                |
| **舵机**           | 信号线→D11(PWM), VCC→5V, GND→GND                          |
| **LiDAR(I2C)**     | SDA→A4, SCL→A5, VCC→5V, GND→GND（与MPU6050共享I2C）       |
| **1.2寸屏幕(SPI)** | SCK→D13, MOSI→D12, CS→D8, DC→A3, RST→A2, VCC→5V, GND→GND  |

*注意：I2C设备（MPU6050和LiDAR）共享SDA/SCL线*

---

## 四、项目实施步骤

### 第一阶段：硬件组装（3-5天）
1. **底盘搭建**
   - 固定电机、安装车轮
   - 安装万向轮
   - 规划元件布局（重心尽量靠下）

2. **电路连接**
   - 按接线方案连接所有模块
   - 测试电源电压是否正常
   - 检查短路风险

3. **传感器安装**
   - MPU6050固定在底盘中央（保持水平）
   - 红外传感器安装在底盘底部前方（距地面2-5mm）
   - 舵机安装在小车前方，LiDAR固定在舵机上

### 第二阶段：基础测试（2-3天）
1. **传感器测试**
   - 测试MPU6050数据读取
   - 测试红外传感器读数
   - 测试LiDAR距离测量
   - 测试舵机旋转角度
   - 测试屏幕显示功能

2. **电机测试**
   - 测试电机正反转
   - 测试编码器脉冲计数
   - 校准电机速度

### 第三阶段：功能开发（7-10天）

#### 1. 平衡控制（PID算法）
```cpp
// 伪代码框架
void balanceControl() {
  // 读取MPU6050角度和角速度
  // 计算PID输出
  // 控制电机PWM
}
```

#### 2. 循线功能
```cpp
void lineTracking() {
  // 读取红外传感器
  // 判断偏离方向
  // 调整电机差速
}
```

#### 3. 障碍物扫描与显示
```cpp
void scanObstacle() {
  // 舵机扫描0-180度
  // 每个角度读取LiDAR距离
  // 在屏幕绘制障碍物图
}
```

#### 4. 屏幕显示界面
- 实时显示障碍物距离图
- 显示小车状态（角度、速度、电池电压）
- 显示循线状态

### 第四阶段：系统集成（3-5天）
1. **多任务调度**
   - 平衡控制（最高优先级，循环周期5-10ms）
   - 循线调整（中优先级，循环周期50ms）
   - 障碍物扫描（低优先级，循环周期500ms）
   - 屏幕刷新（低优先级，循环周期100ms）

2. **参数调优**
   - PID参数整定
   - 循线灵敏度调整
   - 障碍物阈值设置

### 第五阶段：测试与优化（2-3天）
1. 场地测试
2. 稳定性测试
3. 电池续航测试
4. 代码优化

---

## 五、关键技术要点

### 1. 平衡算法
- 使用互补滤波或卡尔曼滤波融合加速度计和陀螺仪数据
- PID控制器调整电机输出
- 建议先在静止状态调试平衡

### 2. 循线策略
- 三路传感器：左黑、中白、右黑→右转
- 可使用加权平均算法实现平滑转向

### 3. 障碍物可视化
- 使用极坐标转换为屏幕坐标
- 采用颜色编码表示距离（绿色=远，红色=近）

### 4. 性能优化
- 避免使用delay()，改用millis()计时
- I2C通信速度设置为400kHz（快速模式）
- 屏幕只刷新变化区域

---

## 六、预算估算（人民币）

| 项目                | 价格范围     |
| ------------------- | ------------ |
| Arduino UNO R4 WiFi | ¥130-180     |
| 电机+驱动+车轮套件  | ¥50-100      |
| MPU6050             | ¥8-15        |
| 红外传感器×5        | ¥10-20       |
| LiDAR（TF-Luna）    | ¥80-150      |
| 舵机                | ¥10-20       |
| 1.2寸屏幕           | ¥15-30       |
| 电池+充电器         | ¥40-80       |
| 其他配件            | ¥30-50       |
| **总计**            | **¥373-645** |

---

## 七、开发时间线

- **Week 1**: 采购零件、熟悉资料
- **Week 2**: 硬件组装、基础测试
- **Week 3**: 平衡算法开发
- **Week 4**: 集成功能、调试优化

**总预计时间：3-4周**

---

## 八、建议的开发库

1. `Wire.h` - I2C通信
2. `MPU6050.h` - 陀螺仪库
3. `Servo.h` - 舵机控制
4. `Adafruit_GFX.h` + `Adafruit_ST7789.h` - 屏幕驱动
5. `TFMini.h` 或 `VL53L0X.h` - LiDAR驱动
